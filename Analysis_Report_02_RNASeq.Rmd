---
title: "Analysis Report 2: Your Title Here"
author: "Charlotte Lopp"
date: "November 10, 2017"
output: github_document
bibliography: references.bib
csl: bioinformatics.csl
---

# Introduction

  In the 1950s, tobacco companies, with their ingenious advertisements promoting the idea that the quintessence of cool and glamour was or was at least very closely linked to cigarette smoking, started a trend that would change lives for decades. Hollywood icons, screen beauties, and even presidents were smoking and by the late 1950s around half of the population of industrialized nations smoked. The tobacco industry seemed untouchable and unstoppable but it all changed in 1994 when Diane Castano, whose husband died of lung cancer, sued the tobacco industry in the largest potential class action suit in history. Ever since, efforts have been made to expose not only the individual dangers of smoking but also the consequential dangers suffered by those who didn't decide to smoke - secondhand smoking, a concept championed by California politicians. Passive or indirect smoking may be one of the causal factors for lung cancer; it would explain the long-standing riddle of why many women (whose husbands were heavy smokers) develop lung cancer even though they themselves are non-smokers [@hirayama2000non]. 
  
  Lung cancer is a leading cause of cancer-related death worldwide and one of the most common cancers in humans [@jemal2011global]. With the introduction of low-dose computerized tomography screening, early stage diagnosis is slowly increasing but lung cancer remains a devastating disease that has a very poor prognosis [@national2011reduced]. Non-small cell lung cancer (NSCLC) is the most common type of lunch cancer [@navada2006temporal] and accounts for approximately 85% of lung cancer cases in the USA [@sher2008small]. Adenocarcinoma is currently the most common type of NSCLC in Asian and North American patients and accounts for 30% of primary lung cancer in male smokers and 40% in female smokers in the USA [@seo2012transcriptional]. Smoking is the most prevalent risk factor for lung cancer, and the risk increases with the length of time and number of cigarettes people smoked [@powell2013association]. Research within the last decade has revealed differences in molecular characteristics of lung cancers in smokers versus nonsmokers, suggesting distinct pathogenic mechanism [@sun2007lung]. Cheng et al. found that overall gene expression levels were lower in smoker with lung cancer compared with healthy smokers in general [@cheng2012comparison]; Beane et al. found around 200 genes differentially expressed between eight smokers with lung cancer and five smoking healthy controls [@beane2011characterizing]; Han et al. identified 1063 genes that wee differentially expressed between tumor and normal tissues in smoking patients including SPP1, TOP2A, and CRABP2, etc [@han2014rna]. Despite all of them being valuable in adding literature and candidate genes in the collaborative study of lung cancer, non of them focused on identifying differences in gene expression profile between smokers and nonsmokers with lung cancer. Its the Seo et al. study in 2012 that looked at smokers and nonsmokers and utilized a hierarchical clustering method to identify cancer-up, cancer-down, and mixed regulated genes for each patient with extremely overexpressed genes also detected [@seo2012transcriptional].  
  
  RNA-seq analysis provides us with a revolutionary tool for transcriptome analysis and with a novel opportunity to address such inquiries such a differences in gene expression profiles between smoking and nonsmoking patients [@wang2009rna]. RNA-seq offers several key advantages over existing technologies: 1) unlike hybridization-based approaches, RNA-seq is not limited to detecting transcripts that correspond  to existing genomic sequence (which makes it particularly attractive for non-model organisms with genomic sequences that are yet to be determined); 2) RNA-seq has very low, if any, background signal because DNA sequences can be unambiguously mapped to unique regions of the genome; 3) the results of RNA-seq also show high levels of reproducibility, for both technical and biological replicates; and 4) because there are no cloning steps, and with the Helicos technology there is no amplication step, RNA-seq requires less RNA sample [@wang2009rna]. Thus, using this powerful tool, Li et al. performed a large scale transcriptome analysis to identify the genes with altered expression in lung cancer development.

# Methods

## Sample origin and sequencing

  In 2012, Seo et al. conducted transcriptome analysis of lung adenocarcinoma in order to identify the somatic mutations and transcriptional variations associated with lung cancer [@seo2012transcriptional]. They collected 200 fresh surgical specimens of primary lung adenocarcinoma from Korean patients who underwent major lunch resection and recorded diagnosis, gender, cancer stage, and smoking status for each patient. Among these 200 cancer patients, 54.5% (n = 109) were females and 58.0% (n = 116) were never-smokers. Of these, 87 cancer tissues whose driver mutations were not detected by screening tests were analyzed by transcriptome sequencing combined with whole-exome (n = 76) and transcriptome (n = 77) seuqencing of matched normal lung tissue samples. Transcriptome sequencing was a powerful method to use for detecting driver mutations in cancer, since not only somatic point mutations but also aberrant RNA variants such as fusion genes and alternative splicing can be examined. All these sequencing experiments were done as described previously. They generated 14,038,673,860 paired-end 101-bp-long reads from RNA sequencing of 164 samples (87 cancer and 77 corresponding normal tissues). On average, the RNA sequencing throughputs were 9.77 and 7.38 Gbp for cancer and normal tissues, respectively. In the whole-exome sequencing of normal tissues, they obtained 32.96-fold read depth per tissue for regions targeted by the exome capture platform used in this study. 
  
  Li et al. [@li2015rna] downloaded Seo et al.'s RNA-seq data from paired normal and tumor tissues from 34 nonsmoking and 34 smoking patients with lung adenocarcinoma (GEO:GSE40419). They aimed to perform a large scale transcriptome analysis and identify the genes with altered expression in lung cancer development. They also looked for differences in gene expression profiles between smoking and nonsmoking patients in order to better define the impact of smoking in lung cancer development and provide insights that might better individualize treatment strategies for the patients.  

## Computational

  After obtaining the RNA-seq data, Li et al. applied a stringent filter on the data to remove the gene tags with sparse count data. They then used edgeR to identify the genes differently expressed between tumor and normal tissues as well as the genes that varied between nonsmoker and smoker patients. The GLM model in edgeR allowed them to identify the genes that varied between nonsmoker and smoker patients with lung adenocarcinmoa. They identified 175 genes whose expressions were statistically different between nonsmoker and smoker group. For our use of the data, biomartr [@drost2017biomartr] was used to implement straightforward functions for bulk retrieval of all genomci data for the selected files present in databases hosted by the National Center for Biotechnology Information (NCBI) and European Bioinformatics Institute (EMBL-EBI). Trimmomatic [@bolger2014trimmomatic] was used to handle the paired-end data as it was specifically developed to be a more flexible and efficient preprocessing tool. Sailfish [@patro2014sailfish], which is a computational methd for quantifying the abundance of previously annotated RNA isoforms from RNA-seq data, was used because it provides quantification estimates much faster than other existing approaches without loss of accuracy. It exemplifies the potential of lightweight algorithms for efficiently processing sequencing reads by facilitating frequent reanalysis of data and reduicng the need to optimize parameters 

# Results

In addition to a minimum of 4-5 figures/tables (and associated captions), you should include sufficient text in this section to describe what your findings were. Remember that in the results section you just describe what you found, but you don't interpret it - that happens in the discussion.

```{r load-libraries, message = FALSE, echo = FALSE}
# Be sure to install these packages before running this script
# They can be installed either with the intall.packages() function
# or with the 'Packages' pane in RStudio

# load general-use packages
library("dplyr")
library("tidyr")
library("knitr")
library("ggplot2")
library("magrittr")

# this package allows for the easy inclusion of literature citations in our Rmd
# more info here: https://github.com/crsh/citr
# and here:
# http://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html
library("citr")
```

```{r load-data, message = FALSE, echo = FALSE}
# load the dataset from a compressed binary file
# it gets loaded as an object called "final_table"
# this has 3.4 million rows...so you will need to be thoughtful about
# how you analyze the data so that you don't overwhelm your laptop
load("output/final_compiled_counts/joined_count_data.RData")

# changes all columns names to lower case so Travis doesn't complain
names(final_table) %<>% tolower

# test that it loaded correctly before proceeding
stopifnot(exists("final_table"))
```

```{r make-summary-table, echo = FALSE}
# There are many many genes in this dataset, so we can
# subset it down to just a few here to look for interesting patterns
# in the most highly expressed
top_15 <- final_table %>%
  group_by(gender, genename) %>%
  summarize(mean_count = mean(counts_lengthscaledtpm)) %>%
  arrange(desc(mean_count)) %>%
  head(n = 15)

# then we can use the `kable()` function to make a nicely formatted
# markdown table
top_15 %>%
  kable()
```

**Table 1**: The most highly expressed genes in both genders included *SFTPB* and *EEF1A1*.

```{r make-barplot-of-highly-expressed-genes, echo = FALSE}
# this code uses the same data as above, but use it to make a
# barplot - remember geom_col() is just like
# when you use geom_bar(stat = "identity")
top_15 %>%
  ggplot(aes(x = genename,
             y = mean_count,
             fill = gender)) +
    geom_col(position = "dodge") + 
    xlab("Gene Name") +
    ylab("Mean Read Counts") +
    ggtitle("Mean Read Counts Per Gene By Gender") +
    theme(axis.text.x = 
            element_text(angle = 90,
                         hjust = 1))
```

**Figure 1**: Here we show an example figure caption.

```{r make-point-graph}
# this code looks at the relationship between cancer stage and smoking status
final_table %>%
  ggplot(aes(x = cancer_stage,
             y = age_at_diagnosis)) +
      geom_point(size = 1, aes(color = smoking_status)) + 
      ylab("Age at Diagnosis") +
      xlab("Cancer Stage") + 
      ggtitle("The Relationship Between Age at Diagnosis and 
              Cancer Stage by Smoking Status")
```

**Figure 1**: Here we show an example figure caption.

```{r make-facet-grid-of-age-by-length}
final_table %>%
  ggplot(aes(x = age_at_diagnosis,
             y = counts_lengthscaledtpm)) + 
      geom_point(size = 1, aes(color = gender)) + 
      facet_grid(. ~ cancer_stage) + 
      xlab("Age at Diagnosis") + 
      ylab("Scaled Read Counts") + 
      ggtitle("Read Counts by Age at Diagnosis and Cancer 
              Stage by Gender") + 
      theme(axis.text.x = 
            element_text(angle = 90,
                         hjust = 1))
```

**Figure 1**: Here we show an example figure caption.

```{r box-plot-of-gender-by-read-count}
final_table %>%
  group_by(cancer_stage) %>%
  summarize(mean_read_count = mean(counts_lengthscaledtpm),
            sd_read_count = sd(counts_lengthscaledtpm)) %>%
  ggplot(aes(x = cancer_stage,
             y = mean_read_count,
             color = cancer_stage)) +
      geom_errorbar(aes(ymin = mean_read_count - sd_read_count,
                        ymax = mean_read_count + sd_read_count),
                    width = 0.25) +
      geom_point(aes(y = mean_read_count)) +
      ylab("Mean Read Count") + 
      xlab("Cancer Stage") +
      ggtitle("Mean and Standard Deviation of Read Count
              by Cancer Stage")
```

**Figure 1**: Here we show an example figure caption.

```{r make-boxplot-of-highly-expressed-genes, echo = FALSE}
# here we just want to pull out the unique gene names and turn
# them into a vector so we can use it below to make a boxplot
# we use the pull() funtion to get this as a vector, just like
# we did when making histograms several weeks ago
top_genes <- top_15 %>%
  ungroup() %>%
  select(genename) %>%
  unique() %>%
  pull()

# now we need to filter from the full data set again, because
# we don't just want summary data, we want all the data in
# order to make boxplots
final_table %>%
  filter(genename %in% top_genes) %>%
  ggplot(aes(x = genename,
             y = counts_lengthscaledtpm,
             fill = gender)) +
    geom_boxplot() +
    facet_wrap(~cancer_stage) +
    xlab("Gene Name") +
    ylab("Scaled read counts per gene") +
    ggtitle("Read counts per gene by gender and cancer stage") +
    theme_bw() + # simplifies theme
    theme(axis.text.x = # rotates x axis labels vertically
            element_text(angle = 90,
                         hjust = 1))
```

**Figure 2**: Here we show another example figure caption.

# Discussion

Add around 1-2 pages interpreting your results and considering future directions one might take in analyzing these data.

# Sources Cited
